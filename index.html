<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
    <title>Tritone Paradox</title>
  </head>
    <body>
      <h1>Tritone Paradox</h1>
      <p>A demonstration by Jane Plomp</p>
      <p>Thanks for checking this out! This program is meant to demonstrate the tritone paradox.</p>
      <p>Please click on each button to hear a series of two tones.</p>
      <p>Then choose whether the second tone sounds like it is going up or down from the first one.</p>
      <p>After you have listened and responded to each one, click submit.</p>
      <p>Then you can see how others have responded compared to you!</p>


      <script src="js/tone.js"></script>
      <script src="js/Chart.js"></script>

      <script>

        //EQUAL TEMPERAMENTS:
        //Starts at C1:
        COctaves = [65.406, 130.813, 261.626, 523.251, 1046.502, 2093.005, 4186.009];//C1: 32.703
        //Starts at Db1
        DbOctaves = [69.296, 138.591, 277.183, 554.365, 1108.731, 2217.461, 4434.922];//, 4434.922]; Db1: 34.648
        //Starts at D1
        DOctaves = [73.416, 146.832, 293.665, 587.330, 1174.659, 2349.318, 4698.636];//, 4698.636]; D1: 36.708,
        //Starts at Eb1
        EbOctaves = [77.782, 155.563, 311.127, 622.254, 1244.508, 2489.016, 4978.032];//, 4978.032]; E1:38.891
        //Starts at E1
        EOctaves = [41.203, 82.407, 164.814, 329.628, 659.255, 1318.51, 2637.02];//, 5274.041];
        //Starts at F1
        FOctaves = [43.654, 87.307, 174.614, 349.228, 698.456, 1396.913, 2793.826];//, 5587.62];
        //Starts at F#1
        GbOctaves = [46.249, 92.499, 184.997, 369.994, 739.989, 1479.978, 2959.955];
        //Starts at G1
        GOctaves = [48.999, 97.999, 195.998, 391.995, 783.991, 1567.982, 3135.963];
        //Starts at Ab1
        AbOctaves = [51.913, 103.826, 207.652, 415.305, 830.609, 1661.219, 3322.438];//, 6644.875];
        //Starts at A1
        AOctaves = [55, 110, 220, 440, 880, 1760, 3520];
        //Starts at Bb1
        BbOctaves = [58.270, 116.541, 233.082, 466.164, 932.328, 1864.655, 3729.310]
        //Starts at B1
        BOctaves = [61.735, 123.471, 246.942, 493.833, 987.767, 1975.533, 3951.066];//, 7902.133], B0: 30.868

        Octaves = [COctaves, DbOctaves, DOctaves, EbOctaves, EOctaves, FOctaves,
          GbOctaves, GOctaves, AbOctaves, AOctaves, BbOctaves, BOctaves]

        CEqual = COctaves;
        GEqual = GOctaves;
        AEqual = AOctaves;
        CEqualTritone = GbOctaves
        AbTritone = DbOctaves
        GEqualTritone = DbOctaves;
        //Starts at D#2
        AEqualTritone = EbOctaves;
        //JUST INTONATION:
        //Function to find just intonations:
        function findJust(startNote, newArray) {
          for (i=0; i<7; i++) {
            trueNote = startNote;
            newArray.push(trueNote);
            startNote = trueNote*2;
          }
        }
        function findJustTritone(startArray, newArray) {
          if(startArray[0] >46){
            newArray.push(startArray[0]*(5/7));
            for (i=0; i<(startArray.length-1); i++) {
              trueNote = startArray[i]*(7/5);
              newArray.push(trueNote);
            }
          } else {
            for (i=0; i<startArray.length; i++) {
              trueNote = startArray[i]*(7/5);
              newArray.push(trueNote);
            }
          }
        }
        //Finding the specific arrays
        CJust = [];
        DbJust = [];
        DJust = [];
        EbJust = [];
        EJust = [];
        FJust = [];
        GbJust = [];
        GJust = [];
        AbJust = [];
        AJust = [];
        BbJust = [];
        BJust = [];
        CJustTritone = [];
        DbJustTritone = [];
        DJustTritone = [];
        EbJustTritone = [];
        EJustTritone = [];
        FJustTritone = [];
        GbJustTritone = [];
        GJustTritone = [];
        AbJustTritone = [];
        AJustTritone = [];
        BbJustTritone = [];
        BJustTritone = [];

        justArrays = [CJust, DbJust, DJust, EbJust, EJust, FJust, GbJust,
          GJust, AbJust, AJust, BbJust, BJust];
        justTritoneArrays = [CJustTritone, DbJustTritone, DJustTritone,
          EbJustTritone, EJustTritone, FJustTritone, GbJustTritone, GJustTritone,
          AbJustTritone, AJustTritone, BbJustTritone, BJustTritone];
        for(n=0; n<justArrays.length; n++) {
          OGArray = Octaves[n];
          startNote = OGArray[0];
          newNotesArray = justArrays[n];
          newTritoneArray = justTritoneArrays[n];
          findJust(startNote, newNotesArray);
          findJustTritone(newNotesArray, newTritoneArray);
          //console.log("OGArray: " + OGArray);
          OGTritone = Octaves[(n+5)%12]
          console.log(OGTritone);
          console.log(newTritoneArray);
          //console.log("newNotesArray: " + newNotesArray);
          //console.log("newTritoneArray: " +newTritoneArray);
        }
        /*
        OGArray = Octaves[7];
        startNote = OGArray[0]
        newNotesArray = justArrays[7]
        newTritoneArray = justTritoneArrays[7]
        findJust(startNote, newNotesArray);
        findJustTritone(newNotesArray, newTritoneArray);
        */ /*
        CJustTritone = [];
        GJustTritone = [];
        findJust(COctaves[0],CJust);
        findJustTritone(CJust,CJustTritone)
        findJust(GOctaves[0],GJust);
        findJustTritone(GJust,GJustTritone)
        */

        //Creating a spectral envelope!
        function findVolumes(newArray, frequencyArray) {
          for(i=0; i<frequencyArray.length; i++) {
            //Equation taken from Deutsch, North, & Ray, 1990
            volume = 0.5 - 0.05*Math.cos(((2*Math.PI)/frequencyArray.length)*Math.log2(frequencyArray[i]/32))
            multVolume = volume;
            newArray.push(multVolume);
          }
        }
        CJustVolumes = [];
        findVolumes(CJustVolumes, CJust);
        console.log(CJustVolumes);

        //Preparing to play actual tones:
        var polySynth = new Tone.PolySynth(7, Tone.Synth).toMaster();
        var synth1 = new Tone.Synth().toMaster();
        var synth2 = new Tone.Synth().toMaster();
        var synth3 = new Tone.Synth().toMaster();
        var synth4 = new Tone.Synth().toMaster();
        var synth5 = new Tone.Synth().toMaster();
        var synth6 = new Tone.Synth().toMaster();
        var synth7 = new Tone.Synth().toMaster();
        synthArray = [synth1, synth2, synth3, synth4, synth5, synth6, synth7];
        synth1Vol = new Tone.Volume();
        synth2Vol = new Tone.Volume();
        synth3Vol = new Tone.Volume();
        synth4Vol = new Tone.Volume();
        synth5Vol = new Tone.Volume();
        synth6Vol = new Tone.Volume();
        synth7Vol = new Tone.Volume();
        synthVolArray = [synth1Vol, synth2Vol, synth3Vol, synth4Vol, synth5Vol, synth6Vol, synth7Vol];

        //This function will play 7 notes at once:
        function allNotes(noteArray, time) {
          polySynth.volume.value = 0;
          polySynth.triggerAttackRelease([noteArray[0], noteArray[1],
            noteArray[2], noteArray[3], noteArray[4], noteArray[5],
            noteArray[6]], 0.50, time);
        }

        fakeVolumes = [-40, -15, -10, 0, -10, -15, -40]
        fakeVolumesTri = [-25, -12, -5, -5, -12, -25]
        //New form that will play individual tones together:
        function makeTones(notesArray, time) {
          newVolumes = []
          findVolumes(newVolumes, notesArray);
          for(i=0; i<7; i++){
            //synthVolArray[i].volume.value = newVolumes[i]
            console.log("Volume for note " + (i+1) + " is " + fakeVolumes[i]);
            synthArray[i].volume.value = fakeVolumes[i]
            synthArray[i].triggerAttackRelease(notesArray[i], 0.5, time);
          }
        }
        function makeTritones(notesArray, time) {
          newVolumes = []
          findVolumes(newVolumes, notesArray);
          for(i=0; i<7; i++){
            //synthVolArray[i].volume.value = newVolumes[i]
            console.log("Volume for note " + (i+1) + " is " + fakeVolumes[i]);
            synthArray[i].volume.value = fakeVolumes[i]
            synthArray[i].triggerAttackRelease(notesArray[i], 0.5, time);
          }
        }

        function play(noteArray, tritoneArray) {
          const now = 0.50+Tone.now();
          makeTones(noteArray, now+0.5);
          makeTritones(tritoneArray, now+1);
        }
        function playAlt(noteArray, tritoneArray) {
          const now = 0.50+Tone.now();
          allNotes(noteArray, now+0.5);
          allNotes(tritoneArray, now+1);
        }

      </script>
          <button onclick="play(COctaves, GbOctaves)">Pair 01</button>
          <select id="CDir",name="CDir">
            <option value=1>Up</option>
            <option value=0>Down</option>
          </select>
          <br>
          <button onclick="play(EbOctaves, AOctaves)">Pair 02</button>
          <select id="EbDir",name="EbDir">
            <option value=1>Up</option>
            <option value=0>Down</option>
          </select>
          <br>
          <button onclick="play(AbOctaves, DOctaves)">Pair 03</button>
          <select id="AbDir",name="AbDir">
            <option value=1>Up</option>
            <option value=0>Down</option>
          </select>
          <br>
          <button onclick="play(DbOctaves, GOctaves)">Pair 04</button>
          <select id="DbDir",name="DbDir">
            <option value=1>Up</option>
            <option value=0>Down</option>
          </select>
          <br>
          <button onclick="play(BOctaves, FOctaves)">Pair 05</button>
          <select id="BDir",name="BDir">
            <option value=1>Up</option>
            <option value=0>Down</option>
          </select>
          <br>
          <button onclick="play(GbOctaves, COctaves)">Pair 06</button>
          <select id="GbDir",name="GbDir">
            <option value=1>Up</option>
            <option value=0>Down</option>
          </select>
          <br>
          <button onclick="play(BbOctaves, EOctaves)">Pair 07</button>
          <select id="BbDir",name="BbDir">
            <option value=1>Up</option>
            <option value=0>Down</option>
          </select>
          <br>
          <button onclick="play(DOctaves, AbOctaves)">Pair 08</button>
          <select id="DDir",name="DDir">
            <option value=1>Up</option>
            <option value=0>Down</option>
          </select>
          <br>
          <button onclick="play(EOctaves, BbOctaves)">Pair 09</button>
          <select id="EDir",name="EDir">
            <option value=1>Up</option>
            <option value=0>Down</option>
          </select>
          <br>
          <button onclick="play(AOctaves, EbOctaves)">Pair 10</button>
          <select id="ADir",name="ADir">
            <option value=1>Up</option>
            <option value=0>Down</option>
          </select>
          <br>
          <button onclick="play(FOctaves, BOctaves)">Pair 11</button>
          <select id="FDir",name="FDir">
            <option value=1>Up</option>
            <option value=0>Down</option>
          </select>
          <br>
          <button onclick="play(GOctaves, DbOctaves)">Pair 12</button>
          <select id="GDir",name="GDir">
            <option value=1>Up</option>
            <option value=0>Down</option>
          </select>
          <br>
          <button type="button" id="submit">Submit</button>
          <br><br><br><br><br><br><br><br><br><br><br><br><br><br>
          <div id = "C"></div>
          <div id = "Db"></div>
          <div id = "D"></div>
          <div id = "Eb"></div>
          <div id = "E"></div>
          <div id = "F"></div>
          <div id = "Gb"></div>
          <div id = "G"></div>
          <div id = "Ab"></div>
          <div id = "A"></div>
          <div id = "Bb"></div>
          <div id = "B"></div>
        <canvas id="totalGraph" height="120"></canvas>
        <canvas id="individualGraph" height="50"></canvas>



      <script>
      function upDown(value) {
        if(value==1) {
          return "Up"
        } else {
          return "Down"
        }
      }
      var totalC = 0
      var totalDb = 0
      var totalD = 0
      var totalEb = 0
      var totalE = 0
      var totalF = 0
      var totalGb = 0
      var totalG = 0
      var totalAb = 0
      var totalA = 0
      var totalBb = 0
      var totalB = 0
      var responses = 0
      function summarize() {
        responses = responses + 1

        var tempC = parseInt(document.getElementById("CDir").value)
        totalC = totalC + tempC
        var tempDb = parseInt(document.getElementById("DbDir").value)
        totalDb = totalDb + tempDb
        var tempD = parseInt(document.getElementById("DDir").value)
        totalD = totalD + tempD
        var tempEb = parseInt(document.getElementById("EbDir").value)
        totalEb = totalEb + tempEb
        var tempE = parseInt(document.getElementById("EDir").value)
        totalE = totalE + tempE
        var tempF = parseInt(document.getElementById("FDir").value)
        totalF = totalF + tempF
        var tempGb = parseInt(document.getElementById("GbDir").value)
        totalGb = totalGb + tempGb
        var tempG = parseInt(document.getElementById("GDir").value)
        totalG = totalG + tempG
        var tempAb = parseInt(document.getElementById("AbDir").value)
        totalAb = totalAb + tempAb
        var tempA = parseInt(document.getElementById("ADir").value)
        totalA = totalA + tempA
        var tempBb = parseInt(document.getElementById("BbDir").value)
        totalBb = totalBb + tempBb
        var tempB = parseInt(document.getElementById("BDir").value)
        totalB = totalB + tempB
        /*
        document.getElementById("C").innerHTML =
        "C : " + Math.round(totalC/responses*100) + "% thought it was going up. Your response: " + upDown(tempC)
        document.getElementById("Db").innerHTML =
        "Db: " + Math.round(totalDb/responses*100) + "% thought it was going up. Your response: " + upDown(tempDb)
        document.getElementById("D").innerHTML =
        "D : " + Math.round(totalD/responses*100) + "% thought it was going up. Your response: " + upDown(tempD)
        document.getElementById("Eb").innerHTML =
        "Eb: " + Math.round(totalEb/responses*100) + "% thought it was going up. Your response: " + upDown(tempEb)
        document.getElementById("E").innerHTML =
        "E : " + Math.round(totalE/responses*100) + "% thought it was going up. Your response: " + upDown(tempE)
        document.getElementById("F").innerHTML =
        "F : " + Math.round(totalF/responses*100) + "% thought it was going up. Your response: " + upDown(tempF)
        document.getElementById("Gb").innerHTML =
        "Gb: " + Math.round(totalGb/responses*100) + "% thought it was going up. Your response: " + upDown(tempGb)
        document.getElementById("G").innerHTML =
        "G : " + Math.round(totalG/responses*100) + "% thought it was going up. Your response: " + upDown(tempG)
        document.getElementById("Ab").innerHTML =
        "Ab: " + Math.round(totalAb/responses*100) + "% thought it was going up. Your response: " + upDown(tempAb)
        document.getElementById("A").innerHTML =
        "A : " + Math.round(totalA/responses*100) + "% thought it was going up. Your response: " + upDown(tempA)
        document.getElementById("Bb").innerHTML =
        "Bb: " + Math.round(totalBb/responses*100) + "% thought it was going up. Your response: " + upDown(tempBb)
        document.getElementById("B").innerHTML =
        "B : " + Math.round(totalB/responses*100) + "% thought it was going up. Your response: " + upDown(tempB)
        */
        var ctx = document.getElementById("totalGraph").getContext('2d');
        var myChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ["C", "Db", "D", "Eb", "E", "F", "Gb", "G", "Ab", "A", "Bb", "B"],
                datasets: [{
                    label: '# who thought note went up',
                    data: [totalC, totalDb, totalD, totalEb, totalE, totalF, totalGb, totalG, totalAb, totalA, totalBb, totalB],
                    backgroundColor: [
                        'rgba(255, 0, 0, 1)', //red
                        'rgba(225, 40, 40, 1)',
                        'rgba(255, 127, 0, 1)',
                        'rgba(250, 200, 0, 1)',
                        'rgba(255, 255, 0, 1)', //yellow
                        'rgba(155, 255, 0, 1)',
                        'rgba(0, 255, 0, 1)', //green
                        'rgba(0, 191, 51, 1)',
                        'rgba(0, 100, 255, 1)',
                        'rgba(0, 0, 255, 1)', //blue
                        'rgba(70, 0, 255, 1)',
                        'rgba(70, 0, 135, 1)', //indigo
                    ],
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero:true
                        }
                    }]
                }
            }
        });
        var ctx2 = document.getElementById("individualGraph").getContext('2d');
        var myChart = new Chart(ctx2, {
            type: 'bar',
            data: {
                labels: ["C", "Db", "D", "Eb", "E", "F", "Gb", "G", "Ab", "A", "Bb", "B"],
                datasets: [{
                    label: 'When you thought it went up:',
                    data: [tempC, tempDb, tempD, tempEb, tempE, tempF, tempGb, tempG, tempAb, tempA, tempBb, tempB],
                    backgroundColor: [
                        'rgba(255, 0, 0, 1)', //red
                        'rgba(225, 40, 40, 1)',
                        'rgba(255, 127, 0, 1)',
                        'rgba(250, 200, 0, 1)',
                        'rgba(255, 255, 0, 1)', //yellow
                        'rgba(155, 255, 0, 1)',
                        'rgba(0, 255, 0, 1)', //green
                        'rgba(0, 191, 51, 1)',
                        'rgba(0, 100, 255, 1)',
                        'rgba(0, 0, 255, 1)', //blue
                        'rgba(70, 0, 255, 1)',
                        'rgba(70, 0, 135, 1)', //indigo
                    ],
                }]
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero:true
                        }
                    }]
                }
            }
        });
      }

      document.getElementById('submit').addEventListener('click',summarize)
      </script>
    </body>

</html>
